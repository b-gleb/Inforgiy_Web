/*! For license information please see 523.991687f8.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[523],{7333:(e,t,a)=>{a.d(t,{A:()=>n});const n=a(2810).zl0.withParams({browserColorScheme:"dark",backgroundColor:"#1f2836",columnBorder:!0,fontFamily:"inherit",fontSize:10,foregroundColor:"#D6D6D6",headerFontSize:10,headerFontWeight:700,iconSize:12,oddRowBackgroundColor:"#1F2836",spacing:5,wrapperBorderRadius:0},"dark").withParams({browserColorScheme:"light",columnBorder:!0,fontFamily:"inherit",fontSize:10,headerFontSize:10,headerFontWeight:700,iconSize:12,oddRowBackgroundColor:"#F9F9F9",spacing:5,wrapperBorderRadius:0},"light")},8523:(e,t,a)=>{a.r(t),a.d(t,{default:()=>D});var n=a(9950),s=a(2655);function r(e){return(0,s.o)(Date.now(),e)}var l=a(3406),i=a(5888);const o=(0,a(7101).A)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);var c=a(9246),d=a(3291),u=a(9500),h=a(1446),m=a(9492),p=a(1217),f=a(3691),y=a(7333),g=a(2810),x=a(4414);g.syG.registerModules([g.ihh,g.y66,g.Q90,g.JZ0,g.Iws]);const w=(0,n.lazy)((()=>a.e(217).then(a.bind(a,5217)))),b="https://inforgiy-server.fly.dev",k=r();function j(e){return`${e.toString().padStart(2,"0")}:00 - ${(e+1).toString().padStart(2,"0")}:00`}function D(e){let{branch:t,rotaAdmin:a,maxDuties:s,initDataUnsafe:r,setShowWeekly:o}=e;const[d,u]=(0,n.useState)(!0),[p,g]=(0,n.useState)(null),[w,k]=(0,n.useState)([]),[D,C]=(0,n.useState)(null),[S]=(0,n.useState)({sortable:!1,suppressMovable:!0,width:.2*window.innerWidth,cellRenderer:e=>{const a=e.value;if(!Array.isArray(a)||0===a.length)return a;const s=a.map((e=>{var a;const n=null!==(a=null===e||void 0===e?void 0:e.nick.split(" ")[0])&&void 0!==a?a:e.username;return"gp"===t&&1===e.color?(0,x.jsx)("span",{className:"gp-green",children:n},e.id):n}));return(0,x.jsx)(x.Fragment,{children:s.map(((e,t)=>(0,x.jsxs)(n.Fragment,{children:[t>0&&", ",e]},t)))})},cellClass:e=>{const a=e.value;return Array.isArray(a)?0===a.length?"gp"===t?"empty gp":"empty":a.some((e=>e.id===r.user.id))?"my-duty":void 0:""},autoHeight:!0,wrapText:!0});(0,n.useEffect)((()=>(window.Telegram.WebApp.BackButton.onClick((()=>{o(!1)})),window.Telegram.WebApp.BackButton.show(),document.body.dataset.agThemeMode=window.Telegram.WebApp.colorScheme,()=>{window.Telegram.WebApp.BackButton.offClick(),window.Telegram.WebApp.BackButton.hide()})),[o]),(0,n.useEffect)((()=>{(async()=>{const e=[],a=(()=>{const e=[],t=new Date,a=t.getDay(),n=new Date(t);n.setDate(t.getDate()-(a+6)%7);for(let s=0;s<25;s++){const t=new Date(n);t.setDate(n.getDate()+s),e.push(t)}return e})();for(const i of a)try{const a=await c.A.get(`${b}/api/rota`,{params:{branch:t,date:(0,l.GP)(i,"yyyy-MM-dd")}});e.push(a.data)}catch(o){(0,m.A)(o),e.push({})}const n=a.map((e=>({field:(0,l.GP)(e,"yyyy-MM-dd"),headerName:(0,l.GP)(e,"dd.MM EEEEEE",{locale:i.ru})})));k([{field:"index",pinned:"left",headerName:"",valueGetter:e=>j(e.node.rowIndex),cellRenderer:null,cellStyle:null,cellClass:null},...n]);const s=[];for(const t of e)s.push(t.map((e=>e.users)));const r=function(e,t){const a=e.map((e=>e.field));return t[0].map(((e,n)=>{const s={};return a.forEach(((e,a)=>{const r=t[a][n];s[e]=r})),s}))}(n,s);C(r)})()}),[t]);return(0,x.jsxs)(x.Fragment,{children:[d&&(0,x.jsx)(h.A,{}),D&&(0,x.jsx)("div",{className:"w-full h-full fixed inset-0",children:(0,x.jsx)(f.W6,{onGridReady:e=>{e.api.ensureColumnVisible((0,l.GP)(new Date,"yyyy-MM-dd"),"start"),u(!1)},rowData:D,columnDefs:w,defaultColDef:S,className:"w-full h-full",getRowHeight:()=>13,onCellClicked:e=>{var t;"index"===e.colDef.field?o(!1):g({users:null!==(t=null===e||void 0===e?void 0:e.value)&&void 0!==t?t:[],column:e.column,rowNode:e.node})},gridOptions:{theme:y.A}})}),(0,x.jsx)(v,{selectedCellData:p,branch:t,rotaAdmin:a,maxDuties:s,setSelectedCellData:g,initDataUnsafe:r,closePopup:()=>{g(null)}})]})}function v(e){let{selectedCellData:t,branch:a,rotaAdmin:s,maxDuties:r,setSelectedCellData:c,initDataUnsafe:h,closePopup:m}=e;const[f,y]=(0,n.useState)(!1);let g,b;t&&(g=new Date(t.column.colDef.field),b=t.rowNode.rowIndex);const D=async e=>{e.date=t.column.colDef.field,e.timeRange=j(b),(0,p.A)(e).then((e=>{t.rowNode.setDataValue(t.column,e[b].users),c((t=>({...t,users:e[b].users})))})).catch((()=>{}))};return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(d.N,{children:t&&(0,x.jsx)(u.P.div,{className:"fixed inset-0 bg-black",initial:{opacity:0},animate:{opacity:.5},exit:{opacity:0},onClick:m})}),(0,x.jsx)(d.N,{children:t&&(0,x.jsxs)(u.P.div,{className:"pop-up",initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",stiffness:300,damping:30},children:[(0,x.jsxs)("div",{className:"flex justify-between items-center",children:[(0,x.jsx)("h2",{className:"text-xl font-bold dark:text-white",children:"\u0414\u0435\u0436\u0443\u0440\u043d\u044b\u0435"}),(0,x.jsx)("button",{className:"pr-2 text-red-500 text-lg font-bold",onClick:m,children:"\u2715"})]}),(0,x.jsxs)("h3",{className:"text-sm font-medium mb-2 text-gray-500",children:[(0,l.GP)(g,"EEEE dd.MM",{locale:i.ru}),", ",j(b)]}),(0,x.jsxs)("div",{children:[Object.values(t.users).length>0?Object.values(t.users).map(((e,t)=>(0,x.jsxs)("div",{className:"flex items-center justify-between p-4 mb-2 bg-gray-100 dark:bg-neutral-700 dark:text-gray-400 rounded-lg",children:[(0,x.jsx)("span",{className:"font-medium",children:e.nick}),s&&(0,x.jsx)("button",{onClick:()=>{D({type:"remove",branch:a,modifyUserId:e.id,initDataUnsafe:h}).then(window.Telegram.WebApp.HapticFeedback.impactOccurred("light")).catch((()=>{}))},children:"\u2715"})]},t))):(0,x.jsx)("p",{className:"pb-4 text-center text-gray-500",children:"\u0412 \u044d\u0442\u043e \u0432\u0440\u0435\u043c\u044f \u043d\u0435\u0442 \u0434\u0435\u0436\u0443\u0440\u043d\u044b\u0445"}),g>=k&&!t.users.some((e=>e.id===h.user.id))&&t.users.length<r&&(0,x.jsxs)("div",{className:"flex justify-between gap-6",children:[(0,x.jsx)("button",{className:"button-primary",onClick:()=>{D({type:"add",branch:a,modifyUserId:h.user.id,initDataUnsafe:h}).then(window.Telegram.WebApp.HapticFeedback.notificationOccurred("success")).catch((()=>{}))},children:"\u0412\u0437\u044f\u0442\u044c \u0441\u043c\u0435\u043d\u0443"}),s&&(0,x.jsx)("button",{className:"button-secondary",onClick:()=>{y(!0),window.Telegram.WebApp.HapticFeedback.impactOccurred("light")},children:(0,x.jsx)(o,{})})]})]})]})}),f&&(0,x.jsx)(n.Suspense,{fallback:null,children:(0,x.jsx)(w,{mode:"rota_weekly",branch:a,initDataUnsafe:h,handleUpdateCell:D,onClose:()=>{y(!1)}})})]})}}}]);