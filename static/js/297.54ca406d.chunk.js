"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[297,662],{1297:(e,t,n)=>{n.r(t),n.d(t,{default:()=>j});var a=n(9950),r=n(8662),o=n(3406),l=n(7455);function s(e,t){const n=(0,l.a)(e,t?.in);return n.setDate(1),n.setHours(0,0,0,0),n}function u(e,t){const n=(0,l.a)(e,t?.in),a=n.getMonth();return n.setFullYear(n.getFullYear(),a+1,0),n.setHours(23,59,59,999),n}var d=n(5729),i=n(8121);function c(e,t,n){const[a,r]=(0,i.x)(n?.in,e,t);return a.getFullYear()===r.getFullYear()&&a.getMonth()===r.getMonth()}var y=n(2876);function h(e,t,n){return(0,y.f)(e,7*t,n)}var p=n(7652);function f(e,t){const n=(0,p.q)(),a=t?.weekStartsOn??t?.locale?.options?.weekStartsOn??n.weekStartsOn??n.locale?.options?.weekStartsOn??0,r=(0,l.a)(e,t?.in),o=r.getDay(),s=6+(o<a?-7:0)-(o-a);return r.setDate(r.getDate()+s),r.setHours(23,59,59,999),r}var g=n(5888),m=n(9246),w=n(9811),M=n(9492),v=n(3691),b=n(7333);const x={loadingOoo:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430...",inRange:"\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043c\u0435\u0436\u0434\u0443",inRangeStart:"\u0411\u043e\u043b\u044c\u0448\u0435",inRangeEnd:"\u041c\u0435\u043d\u044c\u0448\u0435",applyFilter:"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c",resetFilter:"\u0421\u0431\u0440\u043e\u0441"};var D=n(2810),k=n(4414);D.syG.registerModules([D.ihh,D.mfG,D.Q90,D.tkg,D.Pyv]);const G="https://inforgiy-server.fly.dev";async function S(e,t,n){try{return(await m.A.post(`${G}/api/stats`,{branch:e,user_ids:t,dateRanges:n})).data}catch(a){(0,M.A)(a)}}function P(e){const t=[];for(const[n,a]of Object.entries(e)){const e={user:n};for(const t of a){e[`${t.dateRange[0].split("T")[0]}_${t.dateRange[1].split("T")[0]}`]=t.count}t.push(e)}return{rows:t}}function F(e){let{branch:t,initDataUnsafe:n}=e;const[r,l]=(0,a.useState)(null),[i,y]=(0,a.useState)(null),[p,m]=(0,a.useState)(null),[M]=(0,a.useState)({sortable:!0,filter:"agNumberColumnFilter",filterParams:{filterOptions:["inRange"],inRangeInclusive:!0,buttons:["apply","reset"],closeOnApply:!0,maxNumConditions:1},suppressMovable:!0,wrapText:!0});(0,a.useEffect)((()=>{document.body.dataset.agThemeMode=window.Telegram.WebApp.colorScheme}),[]);const D=(0,a.useMemo)((()=>({type:"fitCellContents"})),[]),G=(0,a.useCallback)((async e=>{if(1===e.columnGroup.level&&!0===e.columnGroup.isExpanded()){const n=[];for(const t of e.columnGroup.children){const e=t.colId.split("_");n.push([e[0],e[1]])}const a=await S(t,r,n),{rows:o}=P(a);m((e=>e.map((e=>{const t=o.find((t=>t.user===e.user));return t?{...e,...t}:e}))))}if(!0===e.columnGroup.isExpanded()){const t=e.columnGroup.children.map((e=>e.getId()));e.api.autoSizeColumns(t)}}),[t,r]);return(0,a.useEffect)((()=>{(async()=>{try{const e=(new Date).getFullYear(),a=(await(0,w.A)(t,n)).map((e=>e.id)),r=function(e){const t=[],n=Array.from({length:12},((e,t)=>t)),a={field:`${e}`,openByDefault:!0,children:[]};for(const r of n){const t=[],n=s(new Date(e,r)),l=u(new Date(e,r));let i=(0,d.k)(n,{weekStartsOn:1});for(;i<=l;){c(i,n)||(i=h(i,1));let e=f(i,{weekStartsOn:1});t.push({field:`${(0,o.GP)(i,"yyyy-MM-dd")}_${(0,o.GP)(e,"yyyy-MM-dd")}`,headerName:`${(0,o.GP)(i,"dd.MM")} - ${(0,o.GP)(e,"dd.MM")}`,columnGroupShow:"open"}),i=h(i,1)}t.push({field:`${(0,o.GP)(n,"yyyy-MM-dd")}_${(0,o.GP)(l,"yyyy-MM-dd")}`,headerName:"\u0418\u0442\u043e\u0433\u043e",columnGroupShow:"closed"}),a.children.push({field:(0,o.GP)(n,"yyyy-MM"),headerName:(0,o.GP)(n,"LLLL",{locale:g.ru}),columnGroupShow:"open",children:t})}return a.children.push({field:`${(0,o.GP)(new Date(e,0,1),"yyyy-MM-dd")}_${(0,o.GP)(new Date(e,11,31),"yyyy-MM-dd")}`,headerName:"\u0418\u0442\u043e\u0433\u043e",columnGroupShow:"closed"}),t.push(a),t}(e),i=function(e){const t=[];t.push([(0,o.GP)(new Date(e,0,1),"yyyy-MM-dd"),(0,o.GP)(new Date(e,11,31),"yyyy-MM-dd")]);const n=Array.from({length:12},((e,t)=>t));for(const a of n){const n=s(new Date(e,a)),r=u(new Date(e,a));t.push([(0,o.GP)(n,"yyyy-MM-dd"),(0,o.GP)(r,"yyyy-MM-dd")])}return t}(e),p=await S(t,a,i),{rows:M}=P(p);l(a),m(M),y([{field:"user",headerName:"\u041f\u043e\u0437\u044b\u0432\u043d\u043e\u0439",filter:null,pinned:"left"},...r])}catch(e){}})()}),[t,n]),(0,k.jsx)(v.W6,{rowData:p,columnDefs:i,defaultColDef:M,onColumnGroupOpened:G,autoSizeStrategy:D,suppressColumnVirtualisation:!0,localeText:x,gridOptions:{theme:b.A}})}function j(e){let{branch:t,initDataUnsafe:n,setShowStats:o}=e;return(0,a.useEffect)((()=>(window.Telegram.WebApp.BackButton.onClick((()=>{o(!1)})),window.Telegram.WebApp.BackButton.show(),()=>{window.Telegram.WebApp.BackButton.offClick(),window.Telegram.WebApp.BackButton.hide()})),[o]),(0,k.jsxs)("div",{className:"w-full h-full flex flex-col fixed inset-0 bg-gray-100 dark:bg-neutral-900",children:[(0,k.jsx)(r.default,{branch:t,user_id:n.user.id}),(0,k.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,k.jsx)(F,{branch:t,initDataUnsafe:n})})]})}},7333:(e,t,n)=>{n.d(t,{A:()=>a});const a=n(2810).zl0.withParams({browserColorScheme:"dark",backgroundColor:"#1f2836",columnBorder:!0,fontFamily:"inherit",fontSize:10,foregroundColor:"#D6D6D6",headerFontSize:10,headerFontWeight:700,iconSize:12,oddRowBackgroundColor:"#1F2836",spacing:5,wrapperBorderRadius:0},"dark").withParams({browserColorScheme:"light",columnBorder:!0,fontFamily:"inherit",fontSize:10,headerFontSize:10,headerFontWeight:700,iconSize:12,oddRowBackgroundColor:"#F9F9F9",spacing:5,wrapperBorderRadius:0},"light")},8662:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var a=n(9950),r=n(3406),o=n(9246),l=n(9492),s=n(4414);const u="https://inforgiy-server.fly.dev";function d(e){var t,n,d,c,y,h;let{branch:p,user_id:f}=e;const[g,m]=(0,a.useState)(null);return(0,a.useEffect)((()=>{const e=new Date,t=e=>{const t=new Date(e);t.setDate(e.getDate()-(0===e.getDay()?6:e.getDay()-1));const n=new Date(t);return n.setDate(t.getDate()+6),[t,n]},n=e=>[new Date(e.getFullYear(),e.getMonth(),1),new Date(e.getFullYear(),e.getMonth()+1,0)],a=t(e),s=t(new Date(e.getTime()-6048e5)),d=n(e),i=n(new Date(e.getFullYear(),e.getMonth()-1,e.getDate())),c=(y=e,[new Date(y.getFullYear(),0,1),new Date(y.getFullYear(),11,31)]);var y;(async()=>{try{const e=await o.A.post(`${u}/api/stats`,{branch:p,user_ids:[f],dateRanges:[[(0,r.GP)(a[0],"yyyy-MM-dd"),(0,r.GP)(a[1],"yyyy-MM-dd")],[(0,r.GP)(s[0],"yyyy-MM-dd"),(0,r.GP)(s[1],"yyyy-MM-dd")],[(0,r.GP)(d[0],"yyyy-MM-dd"),(0,r.GP)(d[1],"yyyy-MM-dd")],[(0,r.GP)(i[0],"yyyy-MM-dd"),(0,r.GP)(i[1],"yyyy-MM-dd")],[(0,r.GP)(c[0],"yyyy-MM-dd"),(0,r.GP)(c[1],"yyyy-MM-dd")]]}),t=Object.values(e.data)[0];m({currentWeek:t[0].count,previousWeek:t[1].count,currentMonth:t[2].count,previousMonth:t[3].count,currentYear:t[4].count})}catch(e){(0,l.A)(e)}})()}),[p,f]),(0,s.jsxs)("div",{className:"flex flex-wrap justify-evenly py-2 bg-gray-100 dark:bg-neutral-900",children:[(0,s.jsx)(i,{label:"\u041d\u0435\u0434\u0435\u043b\u044f",sublabel:"\u043e\u0442 \u043f\u0440\u043e\u0448\u043b\u043e\u0439",current:null!==(t=null===g||void 0===g?void 0:g.currentWeek)&&void 0!==t?t:null,previous:null!==(n=null===g||void 0===g?void 0:g.previousWeek)&&void 0!==n?n:null}),(0,s.jsx)(i,{label:"\u041c\u0435\u0441\u044f\u0446",sublabel:"\u043e\u0442 \u043f\u0440\u043e\u0448\u043b\u043e\u0433\u043e",current:null!==(d=null===g||void 0===g?void 0:g.currentMonth)&&void 0!==d?d:null,previous:null!==(c=null===g||void 0===g?void 0:g.previousMonth)&&void 0!==c?c:null}),(0,s.jsx)(i,{label:"\u0413\u043e\u0434",sublabel:"\u043e\u0442 \u043f\u0440\u043e\u0448\u043b\u043e\u0433\u043e",current:null!==(y=null===g||void 0===g?void 0:g.currentYear)&&void 0!==y?y:null,previous:null!==(h=null===g||void 0===g?void 0:g.previousYear)&&void 0!==h?h:null})]})}const i=e=>{let{label:t,sublabel:n,current:a,previous:r}=e;const o=void 0!==r&&null!==r,l=o&&a>r,u=o?a-r:0;return(0,s.jsxs)("div",{className:"rounded-2xl shadow-md p-2 w-1/4 bg-white dark:bg-neutral-800",children:[(0,s.jsx)("h3",{className:"text-base font-semibold mb-2 text-gray-500 dark:text-gray-400",children:t}),null===a?(0,s.jsxs)("div",{className:"animate-pulse",children:[(0,s.jsx)("div",{className:"h-10 rounded-sm w-3/4 mb-2 bg-gray-200 dark:bg-neutral-700"}),(0,s.jsx)("div",{className:"h-4 rounded-sm w-1/2 bg-gray-200 dark:bg-neutral-700"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"text-2xl font-semibold mb-2 text-gray-800 dark:text-white",children:a}),o&&(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("span",{className:"text-[0.6rem] "+(l?"text-green-500 dark:text-green-400":"text-red-500 dark:text-red-400"),children:[l?"\u2191":"\u2193"," ",Math.abs(u)]}),(0,s.jsx)("span",{className:"text-[0.6rem] ml-1 text-gray-500 dark:text-gray-400",children:n})]})]})]})}},9811:(e,t,n)=>{n.d(t,{A:()=>l});var a=n(9246),r=n(9492);const o="https://inforgiy-server.fly.dev";async function l(e,t){try{return(await a.A.get(`${o}/api/users`,{params:{branch:e,initDataUnsafe:t}})).data}catch(n){throw(0,r.A)(n),n}}}}]);